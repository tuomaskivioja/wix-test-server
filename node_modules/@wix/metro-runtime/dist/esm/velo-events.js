import { pick } from 'lodash';
import { extractDomainEventPayload, serializer, RootPath, } from './velo-index';
export { RootPath };
export function toVeloEvent(domainEvent, serializerParams) {
    const veloEvent = { metadata: toMetadata(domainEvent) };
    if (shouldContainPayload(domainEvent)) {
        const { key, payload } = toVeloPayload(domainEvent, serializerParams);
        veloEvent[key] = payload;
    }
    return veloEvent;
}
function toVeloPayload(domainEvent, serializerParams) {
    const protoPayload = extractDomainEventPayload(domainEvent);
    const payload = serializer(serializerParams).fromJSON(protoPayload);
    const key = domainEvent.actionEvent ? 'data' : 'entity';
    return { key, payload };
}
function toMetadata(domainEvent) {
    return pick(domainEvent, 'id', 'entityId', 'eventTime', 'triggeredByAnonymizeRequest');
}
function isEntityIncludedInDeletedEvent(deletedEvent) {
    return deletedEvent.hasOwnProperty('deletedEntityAsJson');
}
function shouldContainPayload(domainEvent) {
    return (!domainEvent.deletedEvent ||
        isEntityIncludedInDeletedEvent(domainEvent.deletedEvent));
}
//# sourceMappingURL=velo-events.js.map