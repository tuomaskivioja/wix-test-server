"use strict";

exports.__esModule = true;
exports.createMediaConverter = createMediaConverter;
var _domain = require("../domain");
var _convertersUtils = require("./converters-utils");
function createMediaConverter(fieldType, commonType) {
  return {
    types: [commonType],
    [_domain.ConverterType.FROM_JSON]: {
      transform: val => {
        if (!val) {
          return;
        }
        let fileName = '';
        if (val != null && val.filename) {
          fileName = `/${(0, _convertersUtils.encodeText)(val.filename)}`;
        }
        return val.id ? `wix:${fieldType}://v1/${val.id}${fileName}` : val.url;
      }
    },
    [_domain.ConverterType.TO_JSON]: {
      transform: val => {
        if (!val) {
          return;
        }
        const alignedUrl = (0, _convertersUtils.alignIfLegacy)(val, fieldType);
        const {
          protocol,
          pathname
        } = new URL(alignedUrl);
        const [id, filename] = pathname.replace(`${fieldType}://v1/`, '').split('/');
        if (protocol === _convertersUtils.WIX_PROTOCOL) {
          if (!filename) {
            return {
              id
            };
          }
          return {
            id,
            filename: (0, _convertersUtils.decodeText)(filename)
          };
        }
        return {
          url: val
        };
      }
    }
  };
}
//# sourceMappingURL=base-media.js.map