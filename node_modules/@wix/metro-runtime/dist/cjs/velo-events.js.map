{"version":3,"names":["_lodash","require","_veloIndex","exports","RootPath","toVeloEvent","domainEvent","serializerParams","veloEvent","metadata","toMetadata","shouldContainPayload","key","payload","toVeloPayload","protoPayload","extractDomainEventPayload","serializer","fromJSON","actionEvent","pick","isEntityIncludedInDeletedEvent","deletedEvent","hasOwnProperty"],"sources":["../../src/velo-events.ts"],"sourcesContent":["import { pick } from 'lodash';\nimport { SerializerParams } from './types';\nimport {\n  DomainEvent,\n  DomainEventMetadata,\n  extractDomainEventPayload,\n  serializer,\n  RootPath,\n  DeletedEvent,\n} from './velo-index';\n\nexport { RootPath };\n\nexport function toVeloEvent(\n  domainEvent: DomainEvent,\n  serializerParams: SerializerParams,\n): VeloEvent {\n  const veloEvent: VeloEvent = { metadata: toMetadata(domainEvent) };\n\n  if (shouldContainPayload(domainEvent)) {\n    const { key, payload } = toVeloPayload(domainEvent, serializerParams);\n\n    veloEvent[key] = payload;\n  }\n\n  return veloEvent;\n}\n\nfunction toVeloPayload(\n  domainEvent: DomainEvent,\n  serializerParams: SerializerParams,\n) {\n  const protoPayload = extractDomainEventPayload(domainEvent);\n  const payload = serializer(serializerParams).fromJSON(protoPayload);\n  const key: keyof VeloEvent = domainEvent.actionEvent ? 'data' : 'entity';\n\n  return { key, payload };\n}\n\nfunction toMetadata(domainEvent: DomainEvent) {\n  return pick(\n    domainEvent,\n    'id',\n    'entityId',\n    'eventTime',\n    'triggeredByAnonymizeRequest',\n  );\n}\n\ntype VeloEvent = {\n  metadata: DomainEventMetadata;\n  data?: any;\n  entity?: any;\n};\n\nfunction isEntityIncludedInDeletedEvent(deletedEvent: DeletedEvent): boolean {\n  return deletedEvent.hasOwnProperty('deletedEntityAsJson');\n}\n\nfunction shouldContainPayload(domainEvent: DomainEvent) {\n  return (\n    !domainEvent.deletedEvent ||\n    isEntityIncludedInDeletedEvent(domainEvent.deletedEvent)\n  );\n}\n\n"],"mappings":";;;;AAAA,IAAAA,OAAA,GAAAC,OAAA;AAEA,IAAAC,UAAA,GAAAD,OAAA;AAOsBE,OAAA,CAAAC,QAAA,GAAAF,UAAA,CAAAE,QAAA;AAIf,SAASC,WAAWA,CACzBC,WAAwB,EACxBC,gBAAkC,EACvB;EACX,MAAMC,SAAoB,GAAG;IAAEC,QAAQ,EAAEC,UAAU,CAACJ,WAAW;EAAE,CAAC;EAElE,IAAIK,oBAAoB,CAACL,WAAW,CAAC,EAAE;IACrC,MAAM;MAAEM,GAAG;MAAEC;IAAQ,CAAC,GAAGC,aAAa,CAACR,WAAW,EAAEC,gBAAgB,CAAC;IAErEC,SAAS,CAACI,GAAG,CAAC,GAAGC,OAAO;EAC1B;EAEA,OAAOL,SAAS;AAClB;AAEA,SAASM,aAAaA,CACpBR,WAAwB,EACxBC,gBAAkC,EAClC;EACA,MAAMQ,YAAY,GAAG,IAAAC,oCAAyB,EAACV,WAAW,CAAC;EAC3D,MAAMO,OAAO,GAAG,IAAAI,qBAAU,EAACV,gBAAgB,CAAC,CAACW,QAAQ,CAACH,YAAY,CAAC;EACnE,MAAMH,GAAoB,GAAGN,WAAW,CAACa,WAAW,GAAG,MAAM,GAAG,QAAQ;EAExE,OAAO;IAAEP,GAAG;IAAEC;EAAQ,CAAC;AACzB;AAEA,SAASH,UAAUA,CAACJ,WAAwB,EAAE;EAC5C,OAAO,IAAAc,YAAI,EACTd,WAAW,EACX,IAAI,EACJ,UAAU,EACV,WAAW,EACX,6BACF,CAAC;AACH;AAQA,SAASe,8BAA8BA,CAACC,YAA0B,EAAW;EAC3E,OAAOA,YAAY,CAACC,cAAc,CAAC,qBAAqB,CAAC;AAC3D;AAEA,SAASZ,oBAAoBA,CAACL,WAAwB,EAAE;EACtD,OACE,CAACA,WAAW,CAACgB,YAAY,IACzBD,8BAA8B,CAACf,WAAW,CAACgB,YAAY,CAAC;AAE5D","ignoreList":[]}