{"version":3,"names":["_utils","require","_imageServiceConstants","fitTemplate","template","fillTemplate","fillFocalTemplate","cropTemplate","legacyCropTemplate","legacyFillTemplate","upscaleTemplate","qualityTemplate","qualityAutoTemplate","unSharpMaskTemplate","nonProgressiveTemplate","watermarkTemplate","filterTemplatesMap","imageFilters","CONTRAST","BRIGHTNESS","SATURATION","HUE","BLUR","autoEncodeTemplate","AVIFEncodeTemplate","pAVIFEncodeTemplate","animatedTransformTemplate","getImageURI","transformsObj","_transformsObj$src","transformsObjStrArr","parts","forEach","transformPart","transformType","transformTypes","CROP","push","LEGACY_CROP","LEGACY_FILL","legacyFillStr","upscale","FIT","fitStr","FILL","fillStr","FILL_FOCAL","fillFocalStr","transformsStr","join","quality","unsharpMask","progressive","watermark","filters","Object","keys","map","filterName","fileType","GIF","encoding","encodingTypes","AVIF","PAVIF","autoEncode","src","isAnimated","transformed","id","API_VERSION","fileName","preferredExtension"],"sources":["../../../src/engines/transforms.ts"],"sourcesContent":["import { template } from '../helpers/utils';\nimport {\n  imageFilters,\n  transformTypes,\n  API_VERSION,\n  fileType,\n  encodingTypes,\n} from '../helpers/imageServiceConstants';\nimport type { ImageTransformObject, ImageTransformObjectPart } from '../types';\n\n// transform templates\nconst fitTemplate = template`fit/w_${'width'},h_${'height'}`;\nconst fillTemplate = template`fill/w_${'width'},h_${'height'},al_${'alignment'}`;\nconst fillFocalTemplate = template`fill/w_${'width'},h_${'height'},fp_${'focalPointX'}_${'focalPointY'}`;\nconst cropTemplate = template`crop/x_${'x'},y_${'y'},w_${'width'},h_${'height'}`;\n\n// legacy templates\nconst legacyCropTemplate = template`crop/w_${'width'},h_${'height'},al_${'alignment'}`;\nconst legacyFillTemplate = template`fill/w_${'width'},h_${'height'},al_${'alignment'}`;\n\n// upscale template\nconst upscaleTemplate = template`,lg_${'upscaleMethodValue'}`;\n\n// options templates\nconst qualityTemplate = template`,q_${'quality'}`;\nconst qualityAutoTemplate = template`,quality_auto`;\nconst unSharpMaskTemplate = template`,usm_${'radius'}_${'amount'}_${'threshold'}`;\nconst nonProgressiveTemplate = template`,bl`;\nconst watermarkTemplate = template`,wm_${'watermark'}`;\nconst filterTemplatesMap = {\n  [imageFilters.CONTRAST]: template`,con_${'contrast'}`,\n  [imageFilters.BRIGHTNESS]: template`,br_${'brightness'}`,\n  [imageFilters.SATURATION]: template`,sat_${'saturation'}`,\n  [imageFilters.HUE]: template`,hue_${'hue'}`,\n  [imageFilters.BLUR]: template`,blur_${'blur'}`,\n};\nconst autoEncodeTemplate = template`,enc_auto`;\nconst AVIFEncodeTemplate = template`,enc_avif`;\nconst pAVIFEncodeTemplate = template`,enc_pavif`;\nconst animatedTransformTemplate = template`,pstr`;\n\n/**\n * returns image transform uri\n * @param {object}  transformsObj\n *\n * @returns {string}\n */\nfunction getImageURI(transformsObj: ImageTransformObject): string {\n  // construct image transforms\n  const transformsObjStrArr: string[] = [];\n\n  // construct transform\n  transformsObj.parts.forEach((transformPart: ImageTransformObjectPart) => {\n    switch (transformPart.transformType) {\n      case transformTypes.CROP:\n        transformsObjStrArr.push(cropTemplate(transformPart));\n        break;\n\n      case transformTypes.LEGACY_CROP:\n        transformsObjStrArr.push(legacyCropTemplate(transformPart));\n        break;\n\n      case transformTypes.LEGACY_FILL:\n        let legacyFillStr = legacyFillTemplate(transformPart);\n        if (transformPart.upscale) {\n          legacyFillStr += upscaleTemplate(transformPart);\n        }\n        transformsObjStrArr.push(legacyFillStr);\n        break;\n\n      case transformTypes.FIT:\n        let fitStr = fitTemplate(transformPart);\n        if (transformPart.upscale) {\n          fitStr += upscaleTemplate(transformPart);\n        }\n        transformsObjStrArr.push(fitStr);\n        break;\n\n      case transformTypes.FILL:\n        let fillStr = fillTemplate(transformPart);\n        if (transformPart.upscale) {\n          fillStr += upscaleTemplate(transformPart);\n        }\n        transformsObjStrArr.push(fillStr);\n        break;\n\n      case transformTypes.FILL_FOCAL:\n        let fillFocalStr = fillFocalTemplate(transformPart);\n        if (transformPart.upscale) {\n          fillFocalStr += upscaleTemplate(transformPart);\n        }\n        transformsObjStrArr.push(fillFocalStr);\n        break;\n    }\n  });\n\n  let transformsStr = transformsObjStrArr.join('/');\n\n  // construct transform options\n  // quality\n  if (transformsObj.quality) {\n    transformsStr += qualityTemplate(transformsObj);\n  }\n  // un-sharp mask\n  if (transformsObj.unsharpMask) {\n    transformsStr += unSharpMaskTemplate(transformsObj.unsharpMask);\n  }\n  // progressive\n  if (!transformsObj.progressive) {\n    transformsStr += nonProgressiveTemplate(transformsObj);\n  }\n  // watermark\n  if (transformsObj.watermark) {\n    transformsStr += watermarkTemplate(transformsObj);\n  }\n  // filters\n  if (transformsObj.filters) {\n    transformsStr += Object.keys(transformsObj.filters)\n      .map((filterName) =>\n        filterTemplatesMap[filterName](transformsObj.filters),\n      )\n      .join('');\n  }\n\n  // encoding\n  if (transformsObj.fileType !== fileType.GIF) {\n    if (transformsObj.encoding === encodingTypes.AVIF) {\n      transformsStr += AVIFEncodeTemplate(transformsObj);\n      transformsStr += qualityAutoTemplate(transformsObj);\n    } else if (transformsObj.encoding === encodingTypes.PAVIF) {\n      transformsStr += pAVIFEncodeTemplate(transformsObj);\n      transformsStr += qualityAutoTemplate(transformsObj);\n    } else if (transformsObj.autoEncode) {\n      transformsStr += autoEncodeTemplate(transformsObj);\n    }\n  }\n\n  // animated image poster transform\n  if (transformsObj.src?.isAnimated && transformsObj.transformed) {\n    transformsStr += animatedTransformTemplate(transformsObj);\n  }\n\n  // image url string\n  return `${transformsObj.src.id}/${API_VERSION}/${transformsStr}/${transformsObj.fileName}.${transformsObj.preferredExtension}`;\n}\n\nexport { getImageURI };\n"],"mappings":"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","ignoreList":[]}